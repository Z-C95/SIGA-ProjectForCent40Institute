{% extends "base.html" %}
{% block title %}Mi panel de asistencia — Alumno{% endblock %}

{% block content %}
<div class="container mt-2">

  <!-- Encabezado -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3">
    <div>
      <h1 class="h4 mb-1">Mi panel de asistencia</h1>
      <p class="text-muted small mb-0">
        Aquí podés ver un resumen general de tu cursada actual.
      </p>
    </div>
  </div>

  <!-- KPIs principales -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="text-muted small">Asistencia global</div>
          <div class="h3 mb-0">{{ porcentaje_global }}%</div>
          <small class="text-muted">(Presente + Justificado)</small>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="text-muted small">Materias activas</div>
          <div class="h3 mb-0">{{ materias_activas }}</div>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="text-muted small">Inasistencias / Tardanzas</div>
          <div class="h3 mb-0">{{ ausentes_totales }}</div>
        </div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="text-muted small">Justificados pendientes</div>
          <div class="h3 mb-0">{{ justificados_pendientes }}</div>
          <small class="text-muted">A la espera de revisión</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Accesos rápidos -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body d-flex flex-wrap gap-2 align-items-center">
      <span class="text-muted small me-2">Accesos rápidos:</span>

      <a href="{% url 'asistencias:consulta_asistencia' %}" class="btn btn-outline-primary btn-sm">
        Ver mis asistencias
      </a>

      <a href="{% url 'asistencias:subir_certificado' %}" class="btn btn-success btn-sm">
        Subir certificado
      </a>

      <a href="{% url 'asistencias:alumno_metricas' %}" class="btn btn-outline-dark btn-sm">
        Ver mis métricas
      </a>
    </div>
  </div>

  <!-- Materias en riesgo -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-2">
        <h2 class="h6 mb-1">Materias en riesgo</h2>
        <small class="text-muted">
          Se consideran en riesgo las materias con asistencia menor al 75%.
        </small>
      </div>

      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Materia</th>
              <th>Período</th>
              <th class="text-center">% asistencia</th>
              <th class="text-center">Estado</th>
            </tr>
          </thead>
          <tbody>
          {% for item in materias_en_riesgo %}
            <tr>
              <td>{{ item.cursada.materia.nombre }}</td>
              <td>{{ item.cursada.periodo }}</td>
              <td class="text-center">{{ item.porcentaje }}%</td>
              <td class="text-center">
                <span class="badge bg-danger">En riesgo</span>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted small py-3">
                Por ahora no tenés materias en riesgo. Mantené tu asistencia para seguir así.
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
